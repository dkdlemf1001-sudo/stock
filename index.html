import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { 
  TrendingUp, 
  Car, 
  CheckSquare, 
  StickyNote, 
  X, 
  Battery, 
  Wifi, 
  Signal,
  ArrowUpRight,
  ArrowDownRight
} from 'lucide-react';

// --- 1. 가짜 데이터 및 설정 ---
const SPLINE_URL = "https://my.spline.design/example-3d-scene/scene.splinecode"; // ★ 여기에 본인의 Spline URL을 넣으세요 (Public URL)

// 주식 데이터
const STOCK_DATA = [
  { name: "삼성전자", price: "72,500", rate: 1.2, isUp: true },
  { name: "Tesla", price: "$240.5", rate: -0.5, isUp: false },
  { name: "Bitcoin", price: "$45,000", rate: 3.8, isUp: true },
  { name: "S&P 500", price: "4,780", rate: 0.2, isUp: true },
];

// 자동차 소모품 데이터
const CAR_DATA = {
  name: "Genesis GV80",
  totalKm: 45200,
  supplies: [
    { name: "엔진오일", progress: 70, status: "양호" }, // 100%가 교체 시기라고 가정 혹은 반대
    { name: "타이어", progress: 40, status: "주의" },
    { name: "워셔액", progress: 10, status: "부족" },
  ]
};

// --- 2. 메인 컴포넌트 ---
const App = () => {
  const [time, setTime] = useState(new Date());
  const [activeApp, setActiveApp] = useState(null); // 현재 열린 앱

  // 시계 기능
  useEffect(() => {
    const timer = setInterval(() => setTime(new Date()), 1000);
    return () => clearInterval(timer);
  }, []);

  // 날짜 포맷
  const dateString = time.toLocaleDateString('ko-KR', { weekday: 'long', month: 'long', day: 'numeric' });
  const timeString = time.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });

  // 앱 목록 정의
  const apps = [
    { id: 'stocks', name: '내 자산', icon: <TrendingUp size={28} />, color: 'bg-blue-500' },
    { id: 'car', name: '마이카', icon: <Car size={28} />, color: 'bg-slate-700' },
    { id: 'goals', name: '2024 목표', icon: <CheckSquare size={28} />, color: 'bg-green-500' },
    { id: 'memo', name: '메모장', icon: <StickyNote size={28} />, color: 'bg-yellow-500' },
  ];

  return (
    <div className="relative w-full h-screen overflow-hidden bg-black text-white font-sans selection:bg-pink-500 selection:text-white">
      
      {/* --- A. 3D 배경 (Spline) --- */}
      {/* 실제 Spline 사용 시 아래 주석 해제하고 iframe 사용 */}
      <div className="absolute inset-0 z-0">
        {/* <iframe src={SPLINE_URL} frameBorder="0" width="100%" height="100%"></iframe> */}
        
        {/* Spline 로딩 전 대체 배경 (그라데이션) */}
        <div className="w-full h-full bg-gradient-to-br from-indigo-900 via-purple-900 to-black animate-pulse"></div> 
      </div>

      {/* 배경 위 유리 질감 오버레이 */}
      <div className="absolute inset-0 z-0 bg-black/20 backdrop-blur-[2px]"></div>


      {/* --- B. 상태바 (Status Bar) --- */}
      <div className="relative z-10 flex justify-between items-center px-6 py-3 text-sm font-medium opacity-80">
        <div>{timeString}</div>
        <div className="flex gap-2">
          <Signal size={16} />
          <Wifi size={16} />
          <Battery size={16} />
        </div>
      </div>

      {/* --- C. 홈 화면 콘텐츠 --- */}
      <div className="relative z-10 flex flex-col items-center justify-start h-full pt-12 px-6">
        
        {/* 시계 위젯 */}
        <div className="mb-12 text-center">
          <h1 className="text-6xl font-thin tracking-tight mb-2 text-white/90 drop-shadow-lg">{timeString}</h1>
          <p className="text-lg text-white/70">{dateString}</p>
        </div>

        {/* 앱 그리드 (아이콘들) */}
        <div className="grid grid-cols-4 gap-6 w-full max-w-md">
          {apps.map((app) => (
            <motion.button
              key={app.id}
              whileHover={{ scale: 1.1 }}
              whileTap={{ scale: 0.95 }}
              onClick={() => setActiveApp(app.id)}
              className="flex flex-col items-center gap-2"
            >
              <div className={`w-16 h-16 ${app.color} rounded-2xl flex items-center justify-center shadow-lg backdrop-blur-md bg-opacity-80 border border-white/20`}>
                <div className="text-white drop-shadow-md">{app.icon}</div>
              </div>
              <span className="text-xs font-medium text-white/80 shadow-black drop-shadow-md">{app.name}</span>
            </motion.button>
          ))}
        </div>
      </div>

      {/* --- D. 앱 실행 모달 (AnimatePresence) --- */}
      <AnimatePresence>
        {activeApp && (
          <motion.div
            initial={{ y: "100%", opacity: 0 }}
            animate={{ y: 0, opacity: 1 }}
            exit={{ y: "100%", opacity: 0 }}
            transition={{ type: "spring", damping: 25, stiffness: 300 }}
            className="absolute inset-0 z-50 bg-black/60 backdrop-blur-xl flex flex-col"
          >
            {/* 앱 헤더 */}
            <div className="flex justify-between items-center p-6 border-b border-white/10">
              <h2 className="text-2xl font-bold">
                {apps.find(a => a.id === activeApp)?.name}
              </h2>
              <button 
                onClick={() => setActiveApp(null)}
                className="p-2 bg-white/10 rounded-full hover:bg-white/20 transition"
              >
                <X size={24} />
              </button>
            </div>

            {/* 앱 컨텐츠 영역 */}
            <div className="flex-1 overflow-y-auto p-6">
              {activeApp === 'stocks' && <StocksApp />}
              {activeApp === 'car' && <CarApp />}
              {activeApp === 'goals' && <GoalsApp />}
              {activeApp === 'memo' && <MemoApp />}
            </div>
            
            {/* 하단 홈 인디케이터 */}
            <div className="h-8 flex justify-center items-center pb-2" onClick={() => setActiveApp(null)}>
               <div className="w-32 h-1 bg-white/30 rounded-full cursor-pointer"></div>
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
};

// --- 3. 개별 앱 컴포넌트들 ---

const StocksApp = () => (
  <div className="space-y-4">
    <div className="bg-white/5 p-6 rounded-3xl border border-white/10">
      <h3 className="text-white/60 text-sm mb-1">총 평가 자산</h3>
      <p className="text-4xl font-bold">₩ 124,500,000</p>
      <div className="flex items-center gap-1 text-red-400 mt-2 bg-red-500/10 w-fit px-2 py-1 rounded-lg">
        <ArrowUpRight size={16} />
        <span className="text-sm font-bold">+12.5% (이번달)</span>
      </div>
    </div>

    <div className="grid gap-3">
      {STOCK_DATA.map((stock, idx) => (
        <div key={idx} className="flex justify-between items-center bg-white/5 p-4 rounded-2xl border border-white/5 hover:bg-white/10 transition">
          <div>
            <div className="font-bold">{stock.name}</div>
            <div className="text-xs text-white/50">보유중</div>
          </div>
          <div className="text-right">
            <div className="font-semibold">{stock.price}</div>
            <div className={`text-xs flex items-center justify-end gap-1 ${stock.isUp ? 'text-red-400' : 'text-blue-400'}`}>
              {stock.isUp ? <ArrowUpRight size={12}/> : <ArrowDownRight size={12}/>}
              {stock.rate}%
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
);

const CarApp = () => (
  <div className="space-y-6">
    <div className="flex items-center justify-between">
      <div>
        <h2 className="text-2xl font-bold">{CAR_DATA.name}</h2>
        <p className="text-white/50 text-sm">누적 {CAR_DATA.totalKm.toLocaleString()} km</p>
      </div>
      <Car size={48} className="text-slate-400" />
    </div>

    <div className="space-y-4">
      {CAR_DATA.supplies.map((item, idx) => (
        <div key={idx} className="bg-white/5 p-4 rounded-2xl border border-white/10">
          <div className="flex justify-between mb-2">
            <span className="font-medium">{item.name}</span>
            <span className={`text-xs px-2 py-0.5 rounded-full ${item.status === '양호' ? 'bg-green-500/20 text-green-400' : item.status === '주의' ? 'bg-yellow-500/20 text-yellow-400' : 'bg-red-500/20 text-red-400'}`}>
              {item.status}
            </span>
          </div>
          <div className="w-full bg-white/10 h-2 rounded-full overflow-hidden">
            <motion.div 
              initial={{ width: 0 }}
              animate={{ width: `${item.progress}%` }}
              transition={{ duration: 1, delay: 0.2 }}
              className={`h-full rounded-full ${item.progress > 80 ? 'bg-red-500' : 'bg-blue-500'}`}
            />
          </div>
          <div className="text-right text-xs text-white/40 mt-1">{item.progress}% 소모됨</div>
        </div>
      ))}
    </div>
  </div>
);

const GoalsApp = () => {
  const [goals, setGoals] = useState([
    { id: 1, text: "체지방 15% 달성하기", completed: false },
    { id: 2, text: "독서 10권 읽기 (현재 3권)", completed: false },
    { id: 3, text: "매니저 사이트 완성하기", completed: true },
    { id: 4, text: "해외 여행 자금 200만원 모으기", completed: false },
  ]);

  const toggleGoal = (id) => {
    setGoals(goals.map(g => g.id === id ? { ...g, completed: !g.completed } : g));
  };

  const progress = Math.round((goals.filter(g => g.completed).length / goals.length) * 100);

  return (
    <div className="space-y-6">
      <div className="bg-gradient-to-r from-green-500 to-emerald-700 p-6 rounded-3xl text-center shadow-lg">
        <h3 className="font-bold mb-2">2024년 달성률</h3>
        <div className="text-5xl font-black">{progress}%</div>
      </div>

      <div className="space-y-2">
        {goals.map((goal) => (
          <div 
            key={goal.id} 
            onClick={() => toggleGoal(goal.id)}
            className={`flex items-center gap-3 p-4 rounded-xl cursor-pointer transition-all ${goal.completed ? 'bg-white/5 opacity-50' : 'bg-white/10 hover:bg-white/15'}`}
          >
            <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${goal.completed ? 'bg-green-500 border-green-500' : 'border-white/30'}`}>
              {goal.completed && <CheckSquare size={14} className="text-black" />}
            </div>
            <span className={goal.completed ? 'line-through' : ''}>{goal.text}</span>
          </div>
        ))}
      </div>
    </div>
  );
};

const MemoApp = () => {
  const [memo, setMemo] = useState(() => localStorage.getItem('myLifeMemo') || "");

  const handleChange = (e) => {
    setMemo(e.target.value);
    localStorage.setItem('myLifeMemo', e.target.value);
  };

  return (
    <div className="h-full flex flex-col">
      <div className="bg-yellow-100 text-black flex-1 rounded-2xl p-1 overflow-hidden shadow-xl">
        <textarea
          className="w-full h-full bg-transparent p-4 resize-none focus:outline-none text-lg leading-relaxed placeholder-gray-500/50"
          placeholder="여기에 자유롭게 메모하세요..."
          value={memo}
          onChange={handleChange}
        ></textarea>
      </div>
      <p className="text-center text-xs text-white/30 mt-4">자동으로 저장됩니다.</p>
    </div>
  );
};

export default App;
