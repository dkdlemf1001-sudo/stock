<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íˆ¬ì Supporter Pro - Final Fix</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #0a3d62; --accent: #fa983a; --bg: #f4f7f6; --red: #e74c3c; --blue: #3498db; }
        body { font-family: 'Apple SD Gothic Neo', sans-serif; background: var(--bg); margin: 0; padding-bottom: 50px; }
        header { background: var(--primary); color: white; padding: 25px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .summary { background: white; padding: 15px; display: flex; justify-content: space-around; font-weight: bold; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .container { max-width: 800px; margin: 0 auto; padding: 15px; }
        .tabs { display: flex; gap: 5px; margin: 15px 0; }
        .tab { flex: 1; padding: 15px; border: none; background: #ddd; cursor: pointer; border-radius: 8px; font-weight: bold; transition: 0.3s; }
        .tab.active { background: var(--primary); color: white; }
        .content { display: none; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .content.active { display: block; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; }
        input { width: 85%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; text-align: center; }
        .btn { padding: 12px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; width: 100%; margin: 5px 0; }
        .btn-upd { background: #27ae60; color: white; font-size: 16px; }
        .btn-add { background: #eee; color: #333; margin-top: 10px; }
        .card { border-left: 5px solid var(--accent); background: #fff9f2; padding: 15px; margin-bottom: 15px; border-radius: 8px; }
        .card h3 { margin: 0 0 5px 0; color: #d35400; }
        .card p { margin: 0; font-size: 14px; color: #555; line-height: 1.5; }
        .status { font-size: 11px; color: #777; text-align: right; margin-bottom: 5px; }
    </style>
</head>
<body>

<header><h1>íˆ¬ì Supporter Pro</h1></header>

<div class="summary">
    <div>ìì‚° ê°€ì¹˜: <span id="t-val">0</span>ì›</div>
    <div>ì´ ìˆ˜ìµë¥ : <span id="t-pct">0%</span></div>
</div>

<div class="container">
    <div id="status" class="status">ì‹œìŠ¤í…œ ì—°ê²° ì¤‘...</div>
    <div class="tabs">
        <button class="tab active" onclick="openT(0)">ë‚´ í¬íŠ¸í´ë¦¬ì˜¤</button>
        <button class="tab" onclick="openT(1)">ë°ì¼ë¦¬ ì¶”ì²œ</button>
        <button class="tab" onclick="openT(2)">ì¥ê¸° íˆ¬ì</button>
    </div>

    <div id="c0" class="content active">
        <button class="btn btn-upd" onclick="updateAll()">ğŸ”„ ì‹œì„¸ ë™ê¸°í™” ë° ì„œë²„ ì €ì¥</button>
        <div style="overflow-x:auto;">
            <table>
                <thead><tr><th>ì¢…ëª©/í‹°ì»¤</th><th>ìˆ˜ëŸ‰</th><th>ë§¤ìˆ˜ê°€</th><th>í˜„ì¬ê°€</th><th>ìˆ˜ìµ</th><th></th></tr></thead>
                <tbody id="list"></tbody>
            </table>
        </div>
        <button class="btn btn-add" onclick="addRow()">+ ì¢…ëª© ì¶”ê°€</button>
    </div>

    <div id="c1" class="content">
        <div class="card">
            <h3>ğŸš€ ì‚¼ì„±ì „ì (005930)</h3>
            <p>ì™¸ì¸ ë§¤ìˆ˜ì„¸ ìœ ì… ë° ë°˜ë„ì²´ ì—…í™© í„´ì–´ë¼ìš´ë“œ ì‹ í˜¸ê°€ í¬ì°©ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¨ê¸° ëª©í‘œê°€ 82,000ì›.</p>
        </div>
        <div class="card" style="border-left-color: #3498db;">
            <h3>ğŸ‡ºğŸ‡¸ NVIDIA (NVDA)</h3>
            <p>AI ì¸í”„ë¼ ìˆ˜ìš” í­ì¦ìœ¼ë¡œ ì¸í•œ ì‹¤ì  ìƒí–¥ ê¸°ëŒ€ê°ì´ í½ë‹ˆë‹¤. ë¯¸ì¥ ì£¼ë„ì£¼ë¡œ ë‹¨ê¸° ê°•ì„¸ ì˜ˆìƒ.</p>
        </div>
    </div>

    <div id="c2" class="content">
        <div class="card" style="border-left-color: #27ae60;">
            <h3>ğŸ’ ì•ŒíŒŒë²³ C (GOOG)</h3>
            <p>ì˜ê²°ê¶Œì€ ì—†ìœ¼ë‚˜ ë‚®ì€ ë°¸ë¥˜ì—ì´ì…˜ ë§¤ë ¥ì´ í½ë‹ˆë‹¤. AI í”Œë«í¼ ì§€ë°°ë ¥ì„ ê³ ë ¤í•œ ì¥ê¸° ë³´ìœ  ì¶”ì²œ.</p>
        </div>
        <div class="card" style="border-left-color: #27ae60;">
            <h3>ğŸ’ Berkshire Hathaway (BRK-B)</h3>
            <p>ë²„í•ì˜ ì² í•™ì´ ë‹´ê¸´ í˜„ê¸ˆ íë¦„ì˜ ëíŒì™•. ì‹œì¥ í•˜ë½ê¸°ì—ë„ ê°•ë ¥í•œ ë°©ì–´ë ¥ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCtB8mZExH43WIRR2DFQ2E5DjHAUZp1TzI",
        authDomain: "my-stock-site.firebaseapp.com",
        projectId: "my-stock-site",
        databaseURL: "https://my-stock-site-default-rtdb.firebaseio.com", 
        appId: "1:647621503807:web:577ea9e4c5ad70817b418a"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function openT(i) {
        document.querySelectorAll('.content').forEach((c, idx) => c.classList.toggle('active', i === idx));
        document.querySelectorAll('.tab').forEach((t, idx) => t.classList.toggle('active', i === idx));
    }

    window.addRow = (d={}) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td><input type="text" class="n" value="${d.n||''}" placeholder="AAPL / 005930"></td>
            <td><input type="number" class="q" value="${d.q||0}" oninput="calc()"></td>
            <td><input type="number" class="b" value="${d.b||0}" oninput="calc()"></td>
            <td><input type="number" class="c" value="${d.c||0}" readonly style="background:#f9f9f9"></td>
            <td class="r" style="font-weight:bold">0%</td>
            <td onclick="this.closest('tr').remove(); save(); calc();" style="cursor:pointer">âŒ</td>
        `;
        document.getElementById('list').appendChild(tr);
        calc();
    };

    window.calc = () => {
        let tVal = 0, tBuy = 0;
        document.querySelectorAll('#list tr').forEach(row => {
            const q = parseFloat(row.querySelector('.q').value)||0;
            const b = parseFloat(row.querySelector('.b').value)||0;
            const c = parseFloat(row.querySelector('.c').value)||0;
            const res = b > 0 ? ((c-b)/b*100).toFixed(2) : 0;
            const rCell = row.querySelector('.r');
            rCell.innerText = res + "%";
            rCell.style.color = res >= 0 ? '#e74c3c' : '#3498db';
            tBuy += (q * b);
            tVal += (q * c);
        });
        document.getElementById('t-val').innerText = Math.floor(tVal).toLocaleString();
        const tPct = tBuy > 0 ? ((tVal-tBuy)/tBuy*100).toFixed(2) : 0;
        const pctEl = document.getElementById('t-pct');
        pctEl.innerText = tPct + "%";
        pctEl.style.color = tPct >= 0 ? '#e74c3c' : '#3498db';
    };

    window.save = () => {
        const data = Array.from(document.querySelectorAll('#list tr')).map(row => ({
            n: row.querySelector('.n').value.toUpperCase(),
            q: row.querySelector('.q').value,
            b: row.querySelector('.b').value,
            c: row.querySelector('.c').value
        }));
        db.ref('stocks').set(data).then(() => {
            document.getElementById('status').innerText = "â— í´ë¼ìš°ë“œ ì‹¤ì‹œê°„ ë™ê¸°í™”ë¨";
        });
    };

    window.updateAll = async () => {
        const btn = document.querySelector('.btn-upd');
        btn.innerText = "âš¡ ì‹œì„¸ ì‘ë‹µ ëŒ€ê¸° ì¤‘...";
        const rows = document.querySelectorAll('#list tr');

        for (let row of rows) {
            let ticker = row.querySelector('.n').value.trim();
            if(!ticker) continue;
            if(!isNaN(ticker) && ticker.length === 6) ticker += ".KS";

            try {
                // ë” ì•ˆì •ì ì¸ í”„ë¡ì‹œ ì„œë²„ ì‚¬ìš© (AllOrigins)
                const res = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(`https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?interval=1m&range=1d`)}`);
                const json = await res.json();
                const stockData = JSON.parse(json.contents);
                const price = stockData.chart.result[0].meta.regularMarketPrice;
                if(price) row.querySelector('.c').value = price.toFixed(2);
            } catch (e) { console.error(ticker + " ì¡°íšŒ ì‹¤íŒ¨"); }
        }
        btn.innerText = "ğŸ”„ ì‹œì„¸ ë™ê¸°í™” ë° ì„œë²„ ì €ì¥";
        calc(); save();
    };

    window.onload = () => {
        db.ref('stocks').once('value', (snap) => {
            const data = snap.val();
            document.getElementById('list').innerHTML = "";
            if(data) data.forEach(addRow); else addRow();
            document.getElementById('status').innerText = "â— ì„œë²„ ì—°ê²° ì™„ë£Œ";
            calc();
        });
    };
</script>
</body>
</html>
